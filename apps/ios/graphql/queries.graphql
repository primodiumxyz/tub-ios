query GetWalletTransactions($wallet: String!) {
  transactions(
    where: { user_wallet: { _eq: $wallet }, success: { _eq: true } }
    order_by: { created_at: desc }
  ) {
    id
    created_at
    token_mint
    token_amount
    token_price_usd
  }
}

query GetTokenPricesSince($token: String!, $since: timestamptz = "now()") {
  api_trade_history(
    where: { token_mint: { _eq: $token }, created_at: { _gte: $since } }
    order_by: { created_at: asc }
  ) {
    token_price_usd
    created_at
  }
}

query GetTokenCandles(
  $token: String!
  $since: timestamptz = "now()"
  $candle_interval: interval = "1m"
) {
  token_trade_history_candles(
    args: { candle_interval: $candle_interval }
    where: { token_mint: { _eq: $token }, bucket: { _gte: $since } }
  ) {
    bucket
    open_price_usd
    close_price_usd
    high_price_usd
    low_price_usd
    volume_usd
  }
}

query GetBulkTokenMetadata($tokens: [String!]!) {
  token_metadata_formatted(where: { mint: { _in: $tokens } }) {
    mint
    name
    symbol
    image_uri
    supply
    decimals
    description
    external_url
    is_pump_token
  }
}

query GetTokenMetadata($token: String!) {
  token_metadata_formatted(where: { mint: { _eq: $token } }) {
    mint
    name
    symbol
    image_uri
    supply
    decimals
    description
    external_url
    is_pump_token
  }
}

query GetBulkTokenLiveData($tokens: [String!]!) {
  token_stats_interval_comp(
    where: { token_mint: { _in: $tokens } }
    args: { interval: "30m", recent_interval: "2m" }
  ) {
    token_mint
    latest_price_usd
    total_volume_usd
    total_trades
    price_change_pct
    recent_volume_usd
    recent_trades
    recent_price_change_pct
    token_metadata_supply
  }
}

query GetTokenLiveData($token: String!) {
  token_stats_interval_comp(
    where: { token_mint: { _eq: $token } }
    args: { interval: "30m", recent_interval: "2m" }
  ) {
    token_mint
    latest_price_usd
    total_volume_usd
    total_trades
    price_change_pct
    recent_volume_usd
    recent_trades
    recent_price_change_pct
    token_metadata_supply
  }
}


query GetLatestTokenPurchase($wallet: String!, $mint: String!) {
  transactions(
    where: {
      user_wallet: { _eq: $wallet }
      token_mint: { _eq: $mint }
      success: { _eq: true }
      token_amount: { _gt: 0 }
    }
    order_by: { created_at: desc }
    limit: 1
  ) {
    id
    created_at
    token_mint
    token_amount
    token_price_usd
  }
}
