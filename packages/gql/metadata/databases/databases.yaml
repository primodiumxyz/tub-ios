- name: default
  kind: postgres
  configuration:
    connection_info:
      database_url:
        from_env: PG_DATABASE_URL
      isolation_level: read-committed
      use_prepared_statements: false
  customization:
    naming_convention: hasura-default
  logical_models:
    - fields:
        - name: token_id
          type:
            nullable: false
            scalar: uuid
        - name: mint
          type:
            nullable: false
            scalar: text
        - name: name
          type:
            nullable: false
            scalar: varchar
        - name: symbol
          type:
            nullable: false
            scalar: varchar
        - name: latest_price
          type:
            nullable: false
            scalar: numeric
        - name: increase_pct
          type:
            nullable: false
            scalar: float8
        - name: trades
          type:
            nullable: false
            scalar: bigint
        - name: created_at
          type:
            nullable: false
            scalar: timestamptz
        - name: platform
          type:
            nullable: false
            scalar: text
        - name: decimals
          type:
            nullable: true
            scalar: integer
          default: 6
      name: GetFormattedTokensResult
      select_permissions:
        - permission:
            columns:
              - token_id
              - mint
              - name
              - symbol
              - latest_price
              - increase_pct
              - trades
              - created_at
              - platform
              - decimals
            filter: {}
          role: public
    - fields:
        - name: id
          type:
            nullable: false
            scalar: uuid
        - name: account
          type:
            nullable: false
            scalar: uuid
        - name: amount
          type:
            nullable: false
            scalar: numeric
        - name: created_at
          type:
            nullable: false
            scalar: timestamptz
        - name: created_at_offset
          type:
            nullable: false
            scalar: timestamptz
      name: account_transaction_offset_model
    - fields:
        - name: balance
          type:
            nullable: false
            scalar: numeric
      name: balance_offset_model
      select_permissions:
        - permission:
            columns:
              - balance
            filter: {}
          role: public
    - fields:
        - name: id
          type:
            nullable: false
            scalar: uuid
        - name: token
          type:
            nullable: false
            scalar: uuid
        - name: price
          type:
            nullable: false
            scalar: numeric
        - name: created_at
          type:
            nullable: false
            scalar: timestamptz
        - name: internal_token_transaction_ref
          type:
            nullable: true
            scalar: uuid
        - name: created_at_offset
          type:
            nullable: false
            scalar: timestamptz
      name: token_price_history_offset
      select_permissions:
        - permission:
            columns:
              - id
              - token
              - price
              - created_at
              - internal_token_transaction_ref
              - created_at_offset
            filter: {}
          role: public
    - fields:
        - name: id
          type:
            nullable: false
            scalar: uuid
        - name: token
          type:
            nullable: false
            scalar: uuid
        - name: amount
          type:
            nullable: false
            scalar: numeric
        - name: account
          type:
            nullable: false
            scalar: uuid
        - name: created_at
          type:
            nullable: false
            scalar: timestamptz
        - name: created_at_offset
          type:
            nullable: false
            scalar: timestamptz
      name: token_transaction_offset_model
  native_queries:
    - arguments:
        account:
          description: ""
          nullable: false
          type: uuid
        interval:
          description: ""
          nullable: false
          type: interval
        start:
          description: ""
          nullable: false
          type: timestamptz
      code: |-
        SELECT COALESCE(SUM(account_transaction_offset.amount), 0) as balance
        from  (SELECT *, created_at + {{interval}} as created_at_offset from account_transaction) as account_transaction_offset
        where account_transaction_offset.account = {{account}} and account_transaction_offset.created_at_offset <= {{start}}
      returns: balance_offset_model
      root_field_name: account_balance_ignore_interval
    - arguments:
        account:
          description: ""
          nullable: false
          type: uuid
        interval:
          description: ""
          nullable: false
          type: interval
        start:
          description: ""
          nullable: false
          type: timestamptz
        token:
          description: ""
          nullable: false
          type: uuid
      code: "SELECT \n    COALESCE(SUM(token_transaction_offset.amount), 0) AS balance\nFROM (\n    SELECT  \n        token_transaction.id,  \n        token_transaction.token,  \n        token_transaction.amount, \n        account_transaction.account, \n        account_transaction.created_at, \n        account_transaction.created_at + {{interval}} AS created_at_offset\n    FROM \n        token_transaction\n    INNER JOIN \n        account_transaction \n    ON \n        token_transaction.account_transaction = account_transaction.id\n) AS token_transaction_offset\nWHERE \n    token_transaction_offset.account = {{account}} \n    AND token_transaction_offset.token = {{token}} \n    AND token_transaction_offset.created_at_offset <= {{start}};"
      returns: balance_offset_model
      root_field_name: account_token_balance_ignore_interval
    - arguments:
        offset:
          description: ""
          nullable: false
          type: interval
      code: select *, created_at + {{offset}} as created_at_offset from account_transaction
      returns: account_transaction_offset_model
      root_field_name: account_transaction_offset
    - arguments:
        since:
          description: ""
          nullable: false
          type: timestamptz
      code: SELECT * FROM get_formatted_tokens({{since}});
      returns: GetFormattedTokensResult
      root_field_name: get_formatted_tokens_since
    - arguments:
        offset:
          description: ""
          nullable: false
          type: interval
      code: SELECT *, created_at + {{offset}} as created_at_offset from token_price_history
      returns: token_price_history_offset
      root_field_name: token_price_history_offset
    - arguments:
        offset:
          description: ""
          nullable: false
          type: interval
      code: SELECT  token_transaction.id,  token_transaction.token,  token_transaction.amount, account, created_at, created_at + {{offset}} as created_at_offset from token_transaction inner JOIN account_transaction on token_transaction.account_transaction = account_transaction.id
      returns: token_transaction_offset_model
      root_field_name: token_transaction_offset
  tables: "!include default/tables/tables.yaml"
  functions: "!include default/functions/functions.yaml"
